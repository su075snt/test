<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà„ÇØ„Ç§„Ç∫ - „Éó„É≠</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root {
            --bg: #F0F4F8;
            --correct-color: #2ED573;
            --wrong-color: #FF4757;
            --primary: #1E90FF;
        }

        body { 
            font-family: 'M PLUS Rounded 1c', sans-serif; 
            background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden;
        }

        /* Khu v·ª±c ch√≠nh */
        .main-game {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }

        /* B·ªô ƒë·∫øm ƒëi·ªÉm */
        .score-board {
            display: flex; gap: 30px; margin-bottom: 20px; font-size: 1.5rem;
            background: white; padding: 10px 40px; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .question-box {
            background: white; border-radius: 40px; padding: 20px 50px;
            box-shadow: 0 10px 0 #D1D9E6; border: 5px solid var(--primary);
            margin-bottom: 25px; text-align: center;
        }

        .btn-speak { font-size: 5rem; cursor: pointer; background: none; border: none; transition: 0.2s; }
        .btn-speak:hover { transform: scale(1.1); }

        .options-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
            width: 100%; max-width: 450px;
        }

        .option-card {
            background: white; border-radius: 20px; height: 100px;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; cursor: pointer; border: 3px solid #E2E8F0;
            box-shadow: 0 6px 0 #E2E8F0; transition: 0.2s;
        }

        .option-card.correct-anim { background: #DFF9FB; border-color: var(--correct-color); pointer-events: none; }
        .option-card.wrong-anim { background: #FFEBEE; border-color: var(--wrong-color); pointer-events: none; }

        .feedback { font-size: 1.8rem; margin-top: 20px; height: 40px; font-weight: bold; }

        /* M√†n h√¨nh k·∫øt th√∫c */
        #finish-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); display: none;
            flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }

        /* Sidebar b√™n ph·∫£i */
        .sidebar {
            width: 250px; background: white; border-left: 2px solid #D1D9E6;
            padding: 20px; display: flex; flex-direction: column; gap: 20px;
        }
        .control-group { background: #F1F2F6; padding: 15px; border-radius: 15px; }
        select, input { width: 100%; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="finish-screen">
        <h1 style="font-size: 4rem; color: var(--primary);">„ÅäÁñ≤„ÇåÊßò„Åß„Åó„ÅüÔºÅ</h1>
        <p style="font-size: 2rem;">„Çà„Åè„Åå„Çì„Å∞„Å£„Åü„Å≠ÔºÅüåü</p>
        <div id="final-score" style="font-size: 1.5rem; margin: 20px;"></div>
        <button onclick="location.reload()" style="padding: 15px 40px; font-size: 1.5rem; border-radius: 50px; background: var(--correct-color); color: white; border: none; cursor: pointer;">„ÇÇ„ÅÜ„ÅÑ„Å°„Å© „ÅÇ„Åù„Å∂</button>
    </div>

    <div class="main-game">
        <div class="score-board">
            <div style="color: var(--correct-color);">‚≠ï <span id="correct-count">0</span></div>
            <div style="color: var(--wrong-color);">‚ùå <span id="wrong-count">0</span></div>
            <div style="color: #666; font-size: 1rem; align-self: center;">„ÅÆ„Åì„Çä: <span id="remaining-count">26</span></div>
        </div>

        <div class="question-box">
            <button class="btn-speak" id="play-btn">üîä</button>
            <div style="color: #999;">„Åç„ÅÑ„Å¶„Å≠</div>
        </div>

        <div class="options-grid" id="options"></div>
        <div id="feedback" class="feedback"></div>
    </div>

    <div class="sidebar">
        <h2 style="text-align: center; color: var(--primary);">„Åõ„Å£„Å¶„ÅÑ</h2>
        <div class="control-group">
            <label>üéôÔ∏è „Åì„Åà</label>
            <select id="voice-select"></select>
        </div>
        <div class="control-group">
            <label>üê¢ „ÅØ„ÇÑ„Åï: <span id="rate-val">1.0</span></label>
            <input type="range" id="rate-range" min="0.4" max="1.3" step="0.1" value="1.0">
        </div>
    </div>

    <script>
        const synth = window.speechSynthesis;
        let alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
        let quizList = [];
        let currentIdx = 0;
        let correctScore = 0;
        let wrongScore = 0;

        const successMsgs = ["„Åô„Åî„ÅÑÔºÅ", "„ÇÑ„Å£„Åü„Å≠ÔºÅ", "Ê≠£Ëß£ÔºÅ", "„Åô„Å∞„Çâ„Åó„ÅÑÔºÅ"];
        const failMsgs = ["„Åä„Åó„ÅÑÔºÅ", "„Å°„Åå„ÅÜ„Çà", "„Åñ„Çì„Å≠„Çì", "„Å∂„Éº„Å∂„Éº"];

        // X√°o tr·ªôn m·∫£ng
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadVoices() {
            const voices = synth.getVoices().filter(v => v.lang.includes('ja'));
            document.getElementById('voice-select').innerHTML = voices.map(v => `<option value="${v.voiceURI}">${v.name}</option>`).join('');
        }
        speechSynthesis.onvoiceschanged = loadVoices;

        function speak(text) {
            synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.voice = synth.getVoices().find(v => v.voiceURI === document.getElementById('voice-select').value);
            utter.rate = document.getElementById('rate-range').value;
            synth.speak(utter);
        }

        function startNewRound() {
            if (currentIdx >= quizList.length) {
                showFinish();
                return;
            }

            document.getElementById('feedback').textContent = "";
            document.getElementById('remaining-count').textContent = quizList.length - currentIdx;
            
            const currentLetter = quizList[currentIdx];
            let choices = [currentLetter];
            while(choices.length < 4) {
                let rand = alphabet[Math.floor(Math.random() * 26)];
                if(!choices.includes(rand)) choices.push(rand);
            }
            shuffle(choices);

            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = "";
            choices.forEach(letter => {
                const card = document.createElement('div');
                card.className = 'option-card';
                card.textContent = `${letter}${letter.toLowerCase()}`;
                card.onclick = () => checkAnswer(letter, currentLetter, card);
                optionsDiv.appendChild(card);
            });

            document.getElementById('play-btn').onclick = () => speak(currentLetter);
            setTimeout(() => speak(currentLetter), 500);
        }

        function checkAnswer(selected, correct, element) {
            const feedback = document.getElementById('feedback');
            // V√¥ hi·ªáu h√≥a c√°c th·∫ª kh√°c ƒë·ªÉ tr√°nh b·∫•m nhi·ªÅu l·∫ßn
            document.querySelectorAll('.option-card').forEach(c => c.style.pointerEvents = 'none');

            if(selected === correct) {
                correctScore++;
                document.getElementById('correct-count').textContent = correctScore;
                const msg = successMsgs[Math.floor(Math.random() * successMsgs.length)];
                feedback.textContent = "‚≠ï " + msg;
                feedback.style.color = "var(--correct-color)";
                element.classList.add('correct-anim');
                speak(msg);
                
                currentIdx++;
                setTimeout(startNewRound, 1800); // T·ª± ƒë·ªông chuy·ªÉn c√¢u sau 1.8s
            } else {
                wrongScore++;
                document.getElementById('wrong-count').textContent = wrongScore;
                const msg = failMsgs[Math.floor(Math.random() * failMsgs.length)];
                feedback.textContent = "‚ùå " + msg;
                feedback.style.color = "var(--wrong-color)";
                element.classList.add('wrong-anim');
                speak(msg);
                
                // Cho ph√©p b·∫•m l·∫°i n·∫øu sai
                setTimeout(() => {
                    document.querySelectorAll('.option-card').forEach(c => {
                        if(!c.classList.contains('wrong-anim')) c.style.pointerEvents = 'auto';
                    });
                }, 1000);
            }
        }

        function showFinish() {
            document.getElementById('finish-screen').style.display = 'flex';
            document.getElementById('final-score').textContent = `‚≠ï„Åõ„ÅÑ„Åã„ÅÑ: ${correctScore}  /  ‚ùå„Åæ„Å°„Åå„ÅÑ: ${wrongScore}`;
            speak("„ÅäÁñ≤„ÇåÊßò„Åß„Åó„Åü„ÄÇ„Çà„Åè„Åå„Çì„Å∞„Å£„Åü„Å≠ÔºÅ");
        }

        document.getElementById('rate-range').oninput = (e) => document.getElementById('rate-val').textContent = e.target.value;

        // B·∫Øt ƒë·∫ßu game
        window.onload = () => {
            loadVoices();
            quizList = shuffle([...alphabet]); // T·∫°o danh s√°ch c√¢u h·ªèi kh√¥ng tr√πng
            startNewRound();
        };
    </script>
</body>
</html>