<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học Tiếng Nhật IT & Thi Công</title>
    <style>
        :root { --bg: #434343; --text: #0b5394; --card: #ffffff; --accent: #0984e3; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; transition: 0.3s; }
        #side-menu { position: fixed; right: -300px; top: 0; width: 260px; height: 100%; background: #fff; box-shadow: -2px 0 10px rgba(0,0,0,0.1); z-index: 1000; padding: 20px; transition: 0.3s; overflow-y: auto; color: #333; }
        #side-menu.active { right: 0; }
        .menu-btn { position: fixed; top: 15px; right: 15px; z-index: 1001; padding: 10px 15px; background: var(--accent); color: white; border: none; border-radius: 5px; cursor: pointer; }
        .tabs { display: flex; flex-wrap: wrap; gap: 5px; padding: 60px 10px 10px; justify-content: center; }
        .tab-btn { padding: 8px 12px; border: none; background: #dfe6e9; cursor: pointer; border-radius: 4px; font-size: 13px; }
        .tab-btn.active { background: var(--accent); color: white; }
        .grid-container { display: none; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 15px; max-width: 1200px; margin: 0 auto; }
        .grid-container.active { display: grid; }
        .vocab-card { background: var(--card); padding: 15px 5px; border-radius: 8px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee; min-height: 120px; display: flex; flex-direction: column; justify-content: center; }
        .kanji { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; color: #2d3436; }
        .hira { color: #636e72; font-size: 0.9em; margin-bottom: 5px; }
        .viet { color: #d63031; font-size: 0.85em; font-weight: 500; }
        .hidden { display: none !important; }
        @media (max-width: 800px) { .grid-container { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>

<button class="menu-btn" onclick="toggleMenu()">⚙ Cài đặt</button>

<div id="side-menu">
    <h3>Cấu hình</h3>
    <label>Màu nền: <input type="color" id="bgCol" value="#434343"></label><br><br>
    <label>Màu chữ: <input type="color" id="txCol" value="#0b5394"></label><hr>
    <label><input type="checkbox" id="chkHira" checked> Hiện Hiragana</label><br>
    <label><input type="checkbox" id="chkViet" checked> Hiện Tiếng Việt</label><hr>
    <label>Giọng mặc định: <select id="vSel" style="width:100%"></select></label><p style="font-size: 11px; color: gray;">* Hệ thống sẽ tự ưu tiên giọng đúng ngôn ngữ khi đọc Nhật-Việt.</p>
    <label>Tốc độ: <input type="range" id="rate" min="0.5" max="1.5" step="0.1" value="1"></label><br><br>
    <label>Chế độ đọc: 
        <select id="mode" style="width:100%">
            <option value="jp">Chỉ tiếng Nhật</option>
            <option value="jv" selected>Nhật - Việt (Chuẩn)</option>
        </select>
    </label><br><br>
    <button onclick="toggleMenu()" style="width:100%; padding: 10px; background: #eee; border: none; border-radius: 4px; cursor: pointer;">Đóng</button>
</div>

<div class="tabs" id="tabH"></div>
<div id="tabC"></div>

<script>
    const data = [
	 {k:"おはようございます", h:"おはようございます", v:"Chào buổi sáng"},
{k:"失礼します", h:"しつれいします", v:"Em xin phép (vào/ra phòng)"},
{k:"わかりました", h:"わかりました", v:"Em đã hiểu rồi ạ"},
{k:"わかりません", h:"わかりません", v:"Em không hiểu ạ"},
{k:"もう一度お願いします", h:"もういちどおねがいします", v:"Làm ơn nhắc lại một lần nữa"},
{k:"質問があります", h:"しつもんがあります", v:"Em có câu hỏi ạ"},
{k:"ちょっと待ってください", h:"ちょっとまってください", v:"Vui lòng đợi em một chút"},
{k:"お先に失礼します", h:"おさきにしつれいします", v:"Em xin phép về trước"},
{k:"ありがとうございました", h:"ありがとうございました", v:"Em xin cảm ơn (khi kết thúc bài giảng)"},
{k:"すみません、遅れました", h:"すみません、おくれました", v:"Xin lỗi, em đến muộn"},
	];
    while(data.length < 250) {
        let i = data.length + 1;
        data.push({k: `項目 ${i}`, h: `こうもく ${i}`, v: `Mục số ${i} liên quan công việc`});
    }

    const synth = window.speechSynthesis;
    let voices = [];

    function loadVoices() {
        voices = synth.getVoices();
        const vSel = document.getElementById('vSel');
        // Lọc giọng Nhật (ja) và Việt (vi)
        const filtered = voices.filter(v => v.lang.includes('ja') || v.lang.includes('vi'));
        
        vSel.innerHTML = filtered.map(v => {
            const langName = v.lang.includes('ja') ? 'Nhật' : 'Việt';
            return `<option value="${v.name}">${v.name} (${langName})</option>`;
        }).join('');

        // Mặc định chọn giọng Nhật đầu tiên tìm thấy
        const defaultJp = filtered.find(v => v.lang.includes('ja'));
        if(defaultJp) vSel.value = defaultJp.name;
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    function init() {
    loadVoices();
    const tabH = document.getElementById('tabH');
    const tabC = document.getElementById('tabC');

    for (let i = 0; i < 10; i++) {
        const btn = document.createElement('button');
        btn.className = `tab-btn ${i===0?'active':''}`;
        btn.innerText = `Tab ${i+1}`;
        btn.onclick = () => {
            document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
            document.querySelectorAll('.grid-container').forEach(g=>g.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(`t-${i}`).classList.add('active');
        };
        tabH.appendChild(btn);

        const grid = document.createElement('div');
        grid.className = `grid-container ${i===0?'active':''}`;
        grid.id = `t-${i}`;
        
        data.slice(i*25, (i+1)*25).forEach(d => {
            const card = document.createElement('div');
            card.className = 'vocab-card';
            card.innerHTML = `<div class="kanji">${d.k}</div><div class="hira">${d.h}</div><div class="viet">${d.v}</div>`;
            
            card.onclick = () => {
                synth.cancel();
                const mode = document.getElementById('mode').value;
                const speed = document.getElementById('rate').value;
                
                // Lấy danh sách giọng mới nhất (cần thiết cho iOS)
                const currentVoices = window.speechSynthesis.getVoices();
                
                // ƯU TIÊN GIỌNG KYOKO CHO IPHONE
                const voiceJp = currentVoices.find(v => v.name.includes('Kyoko')) || 
                                currentVoices.find(v => v.lang.includes('ja-JP')) ||
                                currentVoices.find(v => v.lang.includes('ja'));

                const voiceVi = currentVoices.find(v => v.lang.includes('vi-VN')) || 
                                currentVoices.find(v => v.lang.includes('vi'));

                // Đọc tiếng Nhật
                const uJp = new SpeechSynthesisUtterance(d.k);
                if (voiceJp) uJp.voice = voiceJp;
                uJp.rate = speed;
                synth.speak(uJp);

                // Nếu chế độ Nhật-Việt (jv) thì đọc tiếp tiếng Việt
                if (mode === 'jv' && voiceVi) {
                    const uVi = new SpeechSynthesisUtterance(d.v);
                    uVi.voice = voiceVi;
                    uVi.rate = speed;
                    synth.speak(uVi);
                }
            };
            grid.appendChild(card);
        });
        tabC.appendChild(grid);
    }
}

    function toggleMenu() { document.getElementById('side-menu').classList.toggle('active'); }

    document.getElementById('chkHira').onchange = e => document.querySelectorAll('.hira').forEach(el => el.classList.toggle('hidden', !e.target.checked));
    document.getElementById('chkViet').onchange = e => document.querySelectorAll('.viet').forEach(el => el.classList.toggle('hidden', !e.target.checked));
    document.getElementById('bgCol').oninput = e => document.documentElement.style.setProperty('--bg', e.target.value);
    document.getElementById('txCol').oninput = e => document.documentElement.style.setProperty('--text', e.target.value);

    window.onload = init;
</script>
</body>
</html>