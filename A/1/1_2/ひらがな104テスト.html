<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã²ã‚‰ãŒãª ãƒã‚¹ã‚¿ãƒ¼ (Hiragana Master)</title>
    <style>
        body { font-family: 'Hiragino Sans', 'Meiryo', sans-serif; background: #fff0f5; text-align: center; padding: 20px; overflow: hidden; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 40px; border: 8px solid #ffb6c1; position: relative; min-height: 550px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        h1 { color: #ff69b4; margin-top: 0; font-size: 28px; }
        .progress { color: #ff8da1; font-size: 16px; margin-bottom: 10px; font-weight: bold; }
        
        /* Hiá»‡u á»©ng O / X */
        #feedback { font-size: 150px; font-weight: bold; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; pointer-events: none; display: none; text-shadow: 0 0 20px rgba(255,255,255,0.8); }
        .correct-mark { color: #ff4757; } 
        .wrong-mark { color: #54a0ff; }   

        .sound-box { font-size: 100px; margin: 20px 0; background: #fff9fa; border-radius: 30px; padding: 20px; cursor: pointer; border: 3px dashed #ffb6c1; transition: 0.3s; }
        .sound-box:hover { background: #ffe4e1; }
        
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        button.choice-btn { padding: 20px; font-size: 50px; border: 4px solid #ffcad4; border-radius: 25px; cursor: pointer; background: white; color: #ff69b4; font-weight: bold; box-shadow: 0 5px 0 #ffcad4; transition: 0.1s; }
        button.choice-btn:hover { background: #fff5f6; }
        button.choice-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-replay { background: #ff69b4; color: white; border: none; padding: 12px 30px; border-radius: 50px; font-size: 18px; margin-bottom: 20px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #d05090; }
        .btn-replay:active { transform: translateY(2px); box-shadow: none; }
        
        #finishScreen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; border-radius: 35px; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        #finishScreen h2 { font-size: 50px; color: #ff1493; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <!-- Hiá»‡u á»©ng O / X -->
    <div id="feedback"></div>

    <!-- MÃ n hÃ¬nh káº¿t thÃºc -->
    <div id="finishScreen">
        <h2>ğŸ‰ ã‚„ã£ãŸãƒ¼ï¼</h2>
        <p style="font-size: 22px; font-weight: bold; color: #ff69b4;">ã²ã‚‰ãŒãª ãœã‚“ã¶ ã‚¯ãƒªã‚¢ï¼<br>(BÃ© Ä‘Ã£ thuá»™c háº¿t Hiragana!)</p>
        <button class="btn-replay" onclick="resetGame()">ã‚‚ã†ã„ã£ã‹ã„ ã‚ãã¶</button>
    </div>

    <h1>ğŸ¶ ã²ã‚‰ãŒãª ã‚¯ã‚¤ã‚º</h1>
    <div class="progress">ã®ã“ã‚Š (CÃ²n láº¡i): <span id="remainCount">104</span> / 104</div>
    
    <div class="sound-box" onclick="speakChar()">â“</div>
    <button class="btn-replay" onclick="speakChar()">ğŸ”Š ã‚‚ã†ã„ã¡ã© ãã</button>
    
    <div id="options" class="options"></div>
</div>

<script>
    // Danh sÃ¡ch 104 chá»¯ Hiragana
    const fullAlphabet = [
        'ã‚','ã„','ã†','ãˆ','ãŠ','ã‹','ã','ã','ã‘','ã“','ã•','ã—','ã™','ã›','ã','ãŸ','ã¡','ã¤','ã¦','ã¨','ãª','ã«','ã¬','ã­','ã®','ã¯','ã²','ãµ','ã¸','ã»','ã¾','ã¿','ã‚€','ã‚','ã‚‚','ã‚„','ã‚†','ã‚ˆ','ã‚‰','ã‚Š','ã‚‹','ãƒ¬','ã‚','ã‚','ã‚’','ã‚“',
        'ãŒ','ã','ã','ã’','ã”','ã–','ã˜','ãš','ãœ','ã','ã ','ã¢','ã¥','ã§','ã©','ã°','ã³','ã¶','ã¹','ã¼','ã±','ã´','ã·','ãº','ã½',
        'ãã‚ƒ','ãã‚…','ãã‚‡','ã—ã‚ƒ','ã—ã‚…','ã—ã‚‡','ã¡ã‚ƒ','ã¡ã‚…','ã¡ã‚‡','ã«ã‚ƒ','ã«ã‚…','ã«ã‚‡','ã²ã‚ƒ','ã²ã‚…','ã²ã‚‡','ã¿ã‚ƒ','ã¿ã‚…','ã¿ã‚‡','ã‚Šã‚ƒ','ã‚Šã‚…','ã‚Šã‚‡','ãã‚ƒ','ãã‚…','ãã‚‡','ã˜ã‚ƒ','ã˜ã‚…','ã˜ã‚‡','ã³ã‚ƒ','ã³ã‚…','ã³ã‚‡','ã´ã‚ƒ','ã´ã‚…','ã´ã‚‡'
    ];

    // ThÃªm danh sÃ¡ch cÃ¢u nÃ³i
    const praises = ["ã™ã”ã„ï¼", "ã›ã„ã‹ã„ï¼", "ã‚„ã£ãŸã­ï¼", "ãã®ã¡ã‚‡ã†ã—ï¼", "ã¦ã‚“ã•ã„ï¼"];
    const encouragements = ["ã–ã‚“ã­ã‚“ï¼", "ã‚ã¨ã§ã™ã“ã—ï¼", "ãŠã—ã„ï¼", "ã¤ãã¯ãŒã‚“ã°ã‚ã†", "ã‚‚ã†ã„ã£ã‹ã„ï¼"];

    let playPool = [];
    let currentTarget = "";
    let isProcessing = false;

    function resetGame() {
        playPool = [...fullAlphabet];
        document.getElementById('finishScreen').style.display = 'none';
        nextQuestion();
    }

    function nextQuestion() {
        if (playPool.length === 0) {
            document.getElementById('finishScreen').style.display = 'flex';
            return;
        }

        isProcessing = false;
        document.getElementById('remainCount').innerText = playPool.length;
        
        currentTarget = playPool[Math.floor(Math.random() * playPool.length)];
        
        let choices = [currentTarget];
        while (choices.length < 4) {
            let randomChar = fullAlphabet[Math.floor(Math.random() * fullAlphabet.length)];
            if (!choices.includes(randomChar)) choices.push(randomChar);
        }
        choices.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';
        choices.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = char;
            btn.onclick = () => checkAnswer(char);
            optionsDiv.appendChild(btn);
        });
        
        setTimeout(() => speak(currentTarget), 400);
    }

    function checkAnswer(selected) {
        if (isProcessing) return;
        isProcessing = true;

        const feedback = document.getElementById('feedback');
        feedback.style.display = 'block';

        if (selected === currentTarget) {
            // Khi ÄÃšNG
            feedback.innerHTML = '<span class="correct-mark">â—‹</span>';
            playPool = playPool.filter(c => c !== currentTarget);
            
            // Äá»c cÃ¢u khen ngáº«u nhiÃªn
            const p = praises[Math.floor(Math.random() * praises.length)];
            speak(p);
            
            setTimeout(() => {
                feedback.style.display = 'none';
                nextQuestion();
            }, 1200);
        } else {
            // Khi SAI
            feedback.innerHTML = '<span class="wrong-mark">Ã—</span>';
            
            // Äá»c cÃ¢u Ä‘á»™ng viÃªn ngáº«u nhiÃªn
            const e = encouragements[Math.floor(Math.random() * encouragements.length)];
            speak(e);
            
            setTimeout(() => {
                feedback.style.display = 'none';
                isProcessing = false;
                speak(currentTarget); // Äá»c láº¡i chá»¯ cÃ¡i cáº§n tÃ¬m
            }, 1200);
        }
    }

    // HÃ m Ä‘á»c chung
    function speak(text) {
        const synth = window.speechSynthesis;
        synth.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'ja-JP';
        utter.rate = 0.8; 
        synth.speak(utter);
    }

    resetGame();
</script>

</body>
</html>