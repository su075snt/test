<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚«ã‚¿ã‚«ãƒŠ ãƒã‚¹ã‚¿ãƒ¼</title>
    <style>
        body { font-family: 'Hiragino Sans', sans-serif; background: #e0f7fa; text-align: center; padding: 20px; overflow: hidden; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 40px; border: 8px solid #4fc3f7; position: relative; min-height: 550px; }
        h1 { color: #0288d1; margin-top: 0; }
        .progress { color: #888; font-size: 16px; margin-bottom: 10px; font-weight: bold; }
        
        /* Khu vá»±c hiá»ƒn thá»‹ káº¿t quáº£ O hoáº·c X */
        #feedback { font-size: 120px; font-weight: bold; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; pointer-events: none; display: none; }
        .correct-mark { color: #ff5252; } /* VÃ²ng trÃ²n Ä‘á» theo kiá»ƒu Nháº­t lÃ  Ä‘Ãºng */
        .wrong-mark { color: #3498db; }   /* Dáº¥u X xanh lÃ  sai */

        .sound-box { font-size: 100px; margin: 20px 0; background: #f1faff; border-radius: 30px; padding: 20px; cursor: pointer; border: 3px dashed #4fc3f7; }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        button.choice-btn { padding: 20px; font-size: 45px; border: 4px solid #81d4fa; border-radius: 25px; cursor: pointer; background: white; color: #0288d1; font-weight: bold; box-shadow: 0 5px 0 #81d4fa; transition: 0.1s; }
        button.choice-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-replay { background: #03a9f4; color: white; border: none; padding: 12px 30px; border-radius: 50px; font-size: 18px; margin-bottom: 20px; cursor: pointer; font-weight: bold; }
        
        #finishScreen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; border-radius: 35px; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        #finishScreen h2 { font-size: 50px; color: #ff69b4; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <!-- Hiá»‡u á»©ng O / X -->
    <div id="feedback"></div>

    <!-- MÃ n hÃ¬nh káº¿t thÃºc -->
    <div id="finishScreen">
        <h2>ğŸ‰ ã‚„ã£ãŸãƒ¼ï¼</h2>
        <p style="font-size: 20px;">ãœã‚“ã¶ ã‚¯ãƒªã‚¢ï¼<br>(Con Ä‘Ã£ hoÃ n thÃ nh táº¥t cáº£!)</p>
        <button class="btn-replay" onclick="resetGame()">ã‚‚ã†ã„ã£ã‹ã„ ã‚ãã¶</button>
    </div>

    <h1>ğŸ¶ ã‚«ã‚¿ã‚«ãƒŠ ã‚¯ã‚¤ã‚º</h1>
    <div class="progress">ã®ã“ã‚Š (CÃ²n láº¡i): <span id="remainCount">104</span> / 104</div>
    
    <div class="sound-box" onclick="speakChar()">â“</div>
    <button class="btn-replay" onclick="speakChar()">ğŸ”Š ã‚‚ã†ã„ã¡ã© ãã</button>
    
    <div id="options" class="options"></div>
</div>
<script>
    const fullAlphabet = [
        'ã‚¢','ã‚¤','ã‚¦','ã‚¨','ã‚ª','ã‚«','ã‚­','ã‚¯','ã‚±','ã‚³','ã‚µ','ã‚·','ã‚¹','ã‚»','ã‚½','ã‚¿','ãƒ','ãƒ„','ãƒ†','ãƒˆ','ãƒŠ','ãƒ‹','ãƒŒ','ãƒ','ãƒ','ãƒ','ã²','ãƒ•','ã¸','ãƒ›','ãƒ','ãƒŸ','ãƒ ','ãƒ¡','ãƒ¢','ãƒ¤','ãƒ¦','ãƒ¨','ãƒ©','ãƒª','ãƒ«','ãƒ¬','ãƒ­','ãƒ¯','ãƒ²','ãƒ³',
        'ã‚¬','ã‚®','ã‚°','ã‚²','ã‚´','ã‚¶','ã‚¸','ã‚º','ã‚¼','ã‚¾','ãƒ€','ãƒ‚','ãƒ…','ãƒ‡','ãƒ‰','ãƒ','ãƒ“','ãƒ–','ãƒ™','ãƒœ','ãƒ‘','ãƒ”','ãƒ—','ãƒš','ãƒ',
        'ã‚­ãƒ£','ã‚­ãƒ¥','ã‚­ãƒ§','ã‚·ãƒ£','ã‚·ãƒ¥','ã‚·ãƒ§','ãƒãƒ£','ãƒãƒ¥','ãƒãƒ§','ãƒ‹ãƒ£','ãƒ‹ãƒ¥','ãƒ‹ãƒ§','ãƒ’ãƒ£','ãƒ’ãƒ¥','ãƒ’ãƒ§','ãƒŸã‚ƒ','ãƒŸãƒ¥','ãƒŸãƒ§','ãƒªãƒ£','ãƒªãƒ¥','ãƒªãƒ§','ã‚®ãƒ£','ã‚®ãƒ¥','ã‚®ãƒ§','ã‚¸ãƒ£','ã‚¸ãƒ¥','ã‚¸ãƒ§','ãƒ“ãƒ£','ãƒ“ãƒ¥','ãƒ“ãƒ§','ãƒ”ãƒ£','ãƒ”ãƒ¥','ãƒ”ãƒ§'
    ];

    // --- DANH SÃCH CÃ‚U NÃ“I ---
    const praises = ["ã™ã”ã„ï¼", "ã›ã„ã‹ã„ï¼", "ã‚„ã£ãŸã­ï¼", "ãã®ã¡ã‚‡ã†ã—ï¼", "ã¦ã‚“ã•ã„ï¼"];
    const encouragements = ["ã–ã‚“ã­ã‚“ï¼", "ã‚ã¨ã§ã™ã“ã—ï¼", "ãŠã—ã„ï¼", "ã¤ãã¯ãŒã‚“ã°ã‚ã†", "ã‚‚ã†ã„ã£ã‹ã„ï¼"];

    let playPool = [];
    let currentTarget = "";
    let isProcessing = false;

    function resetGame() {
        playPool = [...fullAlphabet];
        document.getElementById('finishScreen').style.display = 'none';
        nextQuestion();
    }

    function nextQuestion() {
        if (playPool.length === 0) {
            document.getElementById('finishScreen').style.display = 'flex';
            return;
        }

        isProcessing = false;
        document.getElementById('remainCount').innerText = playPool.length;
        currentTarget = playPool[Math.floor(Math.random() * playPool.length)];
        
        let choices = [currentTarget];
        while (choices.length < 4) {
            let randomChar = fullAlphabet[Math.floor(Math.random() * fullAlphabet.length)];
            if (!choices.includes(randomChar)) choices.push(randomChar);
        }
        choices.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';
        choices.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = char;
            btn.onclick = () => checkAnswer(char);
            optionsDiv.appendChild(btn);
        });
        
        setTimeout(() => speak(currentTarget), 400);
    }

    function checkAnswer(selected) {
        if (isProcessing) return;
        isProcessing = true;

        const feedback = document.getElementById('feedback');
        feedback.style.display = 'block';

        if (selected === currentTarget) {
            // ÄÃšNG
            feedback.innerHTML = '<span class="correct-mark">â—‹</span>';
            playPool = playPool.filter(c => c !== currentTarget);
            
            // Chá»n cÃ¢u khen ngáº«u nhiÃªn vÃ  Ä‘á»c
            const p = praises[Math.floor(Math.random() * praises.length)];
            speak(p);
            
            setTimeout(() => {
                feedback.style.display = 'none';
                nextQuestion();
            }, 1200); // TÄƒng thá»i gian chá» má»™t chÃºt Ä‘á»ƒ nghe háº¿t cÃ¢u
        } else {
            // SAI
            feedback.innerHTML = '<span class="wrong-mark">Ã—</span>';
            
            // Chá»n cÃ¢u Ä‘á»™ng viÃªn ngáº«u nhiÃªn vÃ  Ä‘á»c
            const e = encouragements[Math.floor(Math.random() * encouragements.length)];
            speak(e);
            
            setTimeout(() => {
                feedback.style.display = 'none';
                isProcessing = false;
                speak(currentTarget); // Äá»c láº¡i chá»¯ cÃ¡i cáº§n tÃ¬m Ä‘á»ƒ bÃ© ghi nhá»›
            }, 1200);
        }
    }

    // HÃ m Ä‘á»c chung cho cáº£ chá»¯ cÃ¡i vÃ  cÃ¢u thÃ´ng bÃ¡o
    function speak(text) {
        const synth = window.speechSynthesis;
        synth.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'ja-JP';
        utter.rate = 0.8; 
        synth.speak(utter);
    }

    resetGame();
</script>

</body>
</html>