<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç´„Çø„Ç´„Éä „Åä„Åë„ÅÑ„Åì - Katakana Game</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --primary: #74b9ff; --bg: #f0f7ff; --accent: #fab1a0; --correct: #c8e6c9; --wrong: #ffcdd2; }
        body {
            font-family: 'Kosugi Maru', sans-serif; background-color: var(--bg);
            margin: 0; display: flex; flex-direction: column; align-items: center;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }
        header {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            width: 100%; padding: 15px 0; text-align: center;
            color: white; font-size: 22px; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .tab-container { display: flex; margin: 15px 0; gap: 5px; flex-wrap: wrap; justify-content: center; }
        .tab {
            padding: 10px 15px; cursor: pointer; background: white;
            border: 2px solid var(--primary); border-radius: 20px; font-size: 14px; font-weight: bold;
        }
        .tab.active { background: var(--primary); color: white; }
        
        #game-container {
            width: 90%; max-width: 500px; background: white; min-height: 450px;
            padding: 20px; border-radius: 30px; border: 5px solid var(--accent);
            text-align: center; position: relative; display: flex; flex-direction: column;
        }
        .progress-bar { font-size: 18px; color: #0984e3; margin-bottom: 10px; font-weight: bold; background: #e1f5fe; padding: 5px; border-radius: 10px; }
        
        .audio-box {
            font-size: 80px; width: 120px; height: 120px; background: #f1f2f6;
            border-radius: 50%; border: 4px dashed var(--primary);
            display: inline-flex; align-items: center; justify-content: center;
            margin: 10px auto 20px; cursor: pointer; animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .option-btn {
            padding: 15px 5px; background: white; border: 3px solid #eee;
            border-radius: 15px; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: 0.2s;
        }
        .option-btn .char { font-size: 32px; color: #0984e3; font-weight: bold; }
        .option-btn .emoji { font-size: 24px; }
        .option-btn .word { font-size: 13px; color: #555; font-weight: bold;}
        
        .option-btn.correct { background: var(--correct) !important; border-color: #4caf50; }
        .option-btn.wrong { background: var(--wrong) !important; border-color: #f44336; }

        #result-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; border-radius: 25px; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10;
        }
        .btn-restart {
            margin-top: 20px; padding: 12px 30px; background: #0984e3;
            color: white; border: none; border-radius: 25px; font-size: 18px; cursor: pointer; font-family: 'Kosugi Maru';
        }
        .message { margin-top: 15px; font-size: 18px; font-weight: bold; color: #6c5ce7; min-height: 25px; }
    </style>
</head>
<body>

<header>üåü „Ç´„Çø„Ç´„Éä „Åä„Åë„ÅÑ„Åì üåü</header>

<div class="tab-container">
    <div class="tab active" onclick="initGame('seion', this)">„Åõ„ÅÑ„Åä„Çì (46)</div>
    <div class="tab" onclick="initGame('dakuon', this)">„Å†„Åè„Åä„Çì (25)</div>
    <div class="tab" onclick="initGame('yoon', this)">„Çà„ÅÜ„Åä„Çì (33)</div>
</div>

<div id="game-container">
    <div id="result-screen">
        <div style="font-size: 80px;">ü•á</div>
        <h2>„Ç´„Çø„Ç´„Éä „Éû„Çπ„Çø„ÉºÔºÅ</h2>
        <p>B√© th·∫≠t tuy·ªát v·ªùi!</p>
        <button class="btn-restart" onclick="location.reload()">„ÇÇ„ÅÜ„ÅÑ„Å°„Å© (L√†m l·∫°i)</button>
    </div>

    <div class="progress-bar">„ÅÆ„Åì„Çä (C√≤n l·∫°i): <span id="count">0</span> / <span id="total">0</span></div>
    <div class="audio-box" onclick="playCurrent()">üì¢</div>
    <div id="options" class="options-grid"></div>
    <div class="message" id="message"></div>
</div>

<script>
    const database = {
        seion: [
            {c:"„Ç¢",e:"üêú",w:"„Ç¢„É™"},{c:"„Ç§",e:"üçì",w:"„Ç§„ÉÅ„Ç¥"},{c:"„Ç¶",e:"üê∞",w:"„Ç¶„Çµ„ÇÆ"},{c:"„Ç®",e:"‚úèÔ∏è",w:"„Ç®„É≥„Éî„ÉÑ"},{c:"„Ç™",e:"üëπ",w:"„Ç™„Éã"},
            {c:"„Ç´",e:"üê¢",w:"„Ç´„É°"},{c:"„Ç≠",e:"üçÑ",w:"„Ç≠„Éé„Ç≥"},{c:"„ÇØ",e:"üêª",w:"„ÇØ„Éû"},{c:"„Ç±",e:"üêõ",w:"„Ç±„É†„Ç∑"},{c:"„Ç≥",e:"üé™",w:"„Ç≥„Éû"},
            {c:"„Çµ",e:"üêü",w:"„Çµ„Ç´„Éä"},{c:"„Ç∑",e:"ü¶å",w:"„Ç∑„Ç´"},{c:"„Çπ",e:"üçâ",w:"„Çπ„Ç§„Ç´"},{c:"„Çª",e:"üßº",w:"„Çª„ÉÉ„Ç±„É≥"},{c:"„ÇΩ",e:"üç¶",w:"„ÇΩ„Éï„Éà"},
            {c:"„Çø",e:"üêô",w:"„Çø„Ç≥"},{c:"„ÉÅ",e:"üå∑",w:"„ÉÅ„É•„Éº„É™„ÉÉ„Éó"},{c:"„ÉÑ",e:"üåô",w:"„ÉÑ„Ç≠"},{c:"„ÉÜ",e:"üíå",w:"„ÉÜ„Ç¨„Éü"},{c:"„Éà",e:"üêØ",w:"„Éà„É©"},
            {c:"„Éä",e:"üçÜ",w:"„Éä„Çπ"},{c:"„Éã",e:"ü•ï",w:"„Éã„É≥„Ç∏„É≥"},{c:"„Éå",e:"üêï",w:"„Ç§„Éå"},{c:"„Éç",e:"üê±",w:"„Éç„Ç≥"},{c:"„Éé",e:"üìì",w:"„Éé„Éº„Éà"},
            {c:"„Éè",e:"üå∏",w:"„Éè„Éä"},{c:"„Éí",e:"üêë",w:"„Éí„ÉÑ„Ç∏"},{c:"„Éï",e:"üö¢",w:"„Éï„Éç"},{c:"„Éò",e:"üêç",w:"„Éò„Éì"},{c:"„Éõ",e:"‚≠ê",w:"„Éõ„Ç∑"},
            {c:"„Éû",e:"ü´ò",w:"„Éû„É°"},{c:"„Éü",e:"üçä",w:"„Éü„Ç´„É≥"},{c:"„É†",e:"üêû",w:"„É†„Ç∑"},{c:"„É°",e:"üëì",w:"„É°„Ç¨„Éç"},{c:"„É¢",e:"üçë",w:"„É¢„É¢"},
            {c:"„É§",e:"‚õ∞Ô∏è",w:"„É§„Éû"},{c:"„É¶",e:"‚ùÑÔ∏è",w:"„É¶„Ç≠"},{c:"„É®",e:"‚õµ",w:"„É®„ÉÉ„Éà"},
            {c:"„É©",e:"ü¶Å",w:"„É©„Ç§„Ç™„É≥"},{c:"„É™",e:"üçé",w:"„É™„É≥„Ç¥"},{c:"„É´",e:"üêí",w:"„Çµ„É´"},{c:"„É¨",e:"üçã",w:"„É¨„É¢„É≥"},{c:"„É≠",e:"„É≠„Ç±„ÉÉ„Éà",w:"„É≠„Ç±„ÉÉ„Éà"},
            {c:"„ÉØ",e:"üêä",w:"„ÉØ„Éã"},{c:"„É≤",e:"üìª",w:"„É©„Ç∏„Ç™„É≤„Ç≠„ÇØ"},{c:"„É≥",e:"üîî",w:"„É™„É≥"}
        ],
        dakuon: [
            {c:"„Ç¨",e:"ü¶Ü",w:"„Ç¨„ÉÅ„Éß„Ç¶"},{c:"„ÇÆ",e:"üé∏",w:"„ÇÆ„Çø„Éº"},{c:"„Ç∞",e:"üçá",w:"„Ç∞„É¨„Éº„Éó"},{c:"„Ç≤",e:"üëû",w:"„Ç≤„Çø"},{c:"„Ç¥",e:"ü¶ç",w:"„Ç¥„É™„É©"},
            {c:"„Ç∂",e:"üêò",w:"„Çæ„Ç¶"},{c:"„Ç∏",e:"‚õëÔ∏è",w:"„Ç∏„Ç∑„É≥"},{c:"„Ç∫",e:"üó∫Ô∏è",w:"„ÉÅ„Ç∫"},{c:"„Çº",e:"üçß",w:"„Çº„É™„Éº"},{c:"„Çæ",e:"üßπ",w:"„Çæ„Ç¶„Ç≠„É≥"},
            {c:"„ÉÄ",e:"ü•Å",w:"„Çø„Ç§„Ç≥"},{c:"„ÉÇ",e:"ü©∏",w:"„Éè„Éä„ÉÇ"},{c:"„ÉÖ",e:"üëÉ",w:"„Éè„Éä„Éü„ÉÖ"},{c:"„Éá",e:"üìû",w:"„Éá„É≥„ÉØ"},{c:"„Éâ",e:"üç©",w:"„Éâ„Éº„Éä„ÉÑ"},
            {c:"„Éê",e:"üçå",w:"„Éê„Éä„Éä"},{c:"„Éì",e:"üêç",w:"„Éò„Éì"},{c:"„Éñ",e:"üê∑",w:"„Éñ„Çø"},{c:"„Éô",e:"üç±",w:"„Éô„É≥„Éà„Ç¶"},{c:"„Éú",e:"‚öΩ",w:"„Éú„Éº„É´"},
            {c:"„Éë",e:"üêº",w:"„Éë„É≥„ÉÄ"},{c:"„Éî",e:"üê•",w:"„Éî„É®„Éî„É®"},{c:"„Éó",e:"üçÆ",w:"„Éó„É™„É≥"},{c:"„Éö",e:"üêß",w:"„Éö„É≥„ÇÆ„É≥"},{c:"„Éù",e:"üìÆ",w:"„Éù„Çπ„Éà"}
        ],
        yoon: [
            {c:"„Ç≠„É£",e:"üê±",w:"„Ç≠„É£„ÇØ"},{c:"„Ç≠„É•",e:"ü•í",w:"„Ç≠„É•„Ç¶„É™"},{c:"„Ç≠„Éß",e:"ü¶à",w:"„Ç≠„Éß„É™„É•„Ç¶"},
            {c:"„Ç∑„É£",e:"üöó",w:"„Ç∑„É£„Ç∑„É≥"},{c:"„Ç∑„É•",e:"üß§",w:"„Ç∑„É•„ÇÆ„Éß„Ç¶"},{c:"„Ç∑„Éß",e:"üöí",w:"„Ç∑„Éß„Ç¶„Éú„Ç¶„Ç∑„É£"},
            {c:"„ÉÅ„É£",e:"üçµ",w:"„Ç™„ÉÅ„É£"},{c:"„ÉÅ„É•",e:"üê≠",w:"„ÉÅ„É•„Ç¶"},{c:"„ÉÅ„Éß",e:"üç´",w:"„ÉÅ„Éß„Ç≥„É¨„Éº„Éà"},
            {c:"„Éã„É£",e:"üò∏",w:"„Éã„É£„É≥„Ç≥"},{c:"„Éã„É•",e:"ü•õ",w:"„Éã„É•„Ç¶„Éã„É•„Ç¶"},{c:"„Éã„Éß",e:"üêç",w:"„Éã„Éß„É≠„Éã„Éß„É≠"},
            {c:"„Éí„É£",e:"‚ùÑÔ∏è",w:"„Éí„É£„ÇØ"},{c:"„Éí„É•",e:"üå¨Ô∏è",w:"„Éí„É•„Ç¶"},{c:"„Éí„Éß",e:"üêÜ",w:"„Éí„Éß„Ç¶"},
            {c:"„Éü„É£",e:"üêæ",w:"„Éü„É£„Ç¢"},{c:"„Éü„É•",e:"üé∂",w:"„Éü„É•„Éº„Ç∏„ÉÉ„ÇØ"},{c:"„Éü„Éß",e:"Ginger",w:"„Éü„Éß„Ç¶„Ç¨"},
            {c:"„É™„É£",e:"ü¶ñ",w:"„É™„É£„ÇØ"},{c:"„É™„É•",e:"üêâ",w:"„É™„É•„Ç¶"},{c:"„É™„Éß",e:"üçµ",w:"„É™„Éß„ÇØ„ÉÅ„É£"},
            {c:"„ÇÆ„É£",e:"üñºÔ∏è",w:"„ÇÆ„É£„É©„É™„Éº"},{c:"„ÇÆ„É•",e:"ü•©",w:"„ÇÆ„É•„Ç¶„Éã„ÇØ"},{c:"„ÇÆ„Éß",e:"üêü",w:"„ÇÆ„Éß„Ç´„Ç§"},
            {c:"„Ç∏„É£",e:"ü•î",w:"„Ç∏„É£„Ç¨„Ç§„É¢"},{c:"„Ç∏„É•",e:"ü•§",w:"„Ç∏„É•„Éº„Çπ"},{c:"„Ç∏„Éß",e:"üë∏",w:"„Ç∏„Éß„Ç™„Ç¶"},
            {c:"„Éì„É£",e:"",w:"„Éì„É£„ÉÉ„Ç≥"},{c:"„Éì„É•",e:"",w:"„Éì„É•„Éº"},{c:"„Éì„Éß",e:"üè•",w:"„Éì„Éß„Ç¶„Ç§„É≥"},
            {c:"„Éî„É£",e:"",w:"„Éè„ÉÉ„Éî„É£„ÇØ"},{c:"„Éî„É•",e:"",w:"„Éî„É•„Ç¢"},{c:"„Éî„Éß",e:"üê∞",w:"„Éî„Éß„É≥„Éî„Éß„É≥"}
        ]
    };
	const encouragements = [
    "„Åñ„Çì„Å≠„ÇìÔºÅ„ÅÇ„Å®„Åß „Åæ„Åü „ÇÑ„Çç„ÅÜ",
    "„Åä„Åó„ÅÑÔºÅ„Å§„Åé„ÅØ „Åå„Çì„Å∞„Çç„ÅÜ",
    "„Å©„Çì„Åæ„ÅÑÔºÅ„ÇÇ„ÅÜ„ÅÑ„Å°„Å© „Éà„É©„Ç§„Å†",
    "„Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂ÔºÅ„Å§„Åé„ÅØ „Åß„Åç„Çã„Çà",
    "„Åä„Å£„Å®ÔºÅ„ÇÇ„ÅÜ‰∏ÄÂõû „Çå„Çì„Åó„ÇÖ„ÅÜ„Å†„Å≠"
];

    const praises = ["„Åô„Åî„ÅÑÔºÅ", "„Å¶„Çì„Åï„ÅÑ„Å†„Å≠ÔºÅ", "„ÇÑ„Å£„Åü„ÉºÔºÅ", "„Å∞„Å£„Å°„ÇäÔºÅ", "„Åä„Åø„Åî„Å®ÔºÅ"];
    let queue = [];
    let currentQ = null;
    let allInTab = [];
    let isProcessing = false;

    function initGame(tab, el) {
        if(el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }
        allInTab = [...database[tab]];
        queue = [...allInTab].sort(() => Math.random() - 0.5);
        document.getElementById('total').innerText = allInTab.length;
        document.getElementById('result-screen').style.display = 'none';
        nextQuestion();
    }

    function playCurrent() { if(currentQ) speak(currentQ.c); }

    function speak(text) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ja-JP';
        u.rate = 0.8;
        window.speechSynthesis.speak(u);
    }

    function nextQuestion() {
        if (queue.length === 0) {
            showResult();
            return;
        }
        isProcessing = false;
        currentQ = queue[0];
        document.getElementById('count').innerText = queue.length;
        document.getElementById('message').innerText = "";
        
        let choices = [currentQ];
        let others = allInTab.filter(item => item.c !== currentQ.c);
        others.sort(() => Math.random() - 0.5);
        choices.push(...others.slice(0, 3));
        choices.sort(() => Math.random() - 0.5);

        const grid = document.getElementById('options');
        grid.innerHTML = "";
        choices.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = `<span class="char">${opt.c}</span><span class="emoji">${opt.e}</span><span class="word">${opt.w}</span>`;
            btn.onclick = () => check(opt, btn);
            grid.appendChild(btn);
        });
        setTimeout(playCurrent, 500);
    }

    function check(selected, btn) {
    if(isProcessing) return;
    isProcessing = true;

    if(selected.c === currentQ.c) {
        btn.classList.add('correct');
        queue.shift(); 
        const p = praises[Math.floor(Math.random() * praises.length)];
        document.getElementById('message').innerText = p;
        speak(p);
        setTimeout(nextQuestion, 1500);
    } else {
        btn.classList.add('wrong');
        
        // 2. L·∫•y ng·∫´u nhi√™n 1 trong 5 c√¢u khuy·∫øn kh√≠ch
        const e = encouragements[Math.floor(Math.random() * encouragements.length)];
        
        // 3. Hi·ªÉn th·ªã v√† ƒë·ªçc c√¢u ng·∫´u nhi√™n ƒë√≥
        document.getElementById('message').innerText = e;
        speak(e); // ƒê·ªçc n·ªôi dung th√¥ng b√°o thay v√¨ ch·ªâ ƒë·ªçc "„Åñ„Çì„Å≠„Çì"
        
        // ƒê∆∞a c√¢u sai xu·ªëng cu·ªëi h√†ng ƒë·ª£i
        const failed = queue.shift();
        queue.push(failed);
        
        setTimeout(nextQuestion, 1500);
    }
}
    function showResult() {
        document.getElementById('result-screen').style.display = 'flex';
        speak("„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ„Ç´„Çø„Ç´„Éä„Éû„Çπ„Çø„Éº„Åß„Åô");
    }

    window.onload = () => initGame('seion');
</script>

</body>
</html>