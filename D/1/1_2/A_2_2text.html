<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Å≤„Çâ„Åå„Å™ „Éû„Çπ„Çø„Éº (Hiragana Master)</title>
    <style>
        body { font-family: 'Hiragino Sans', 'Meiryo', sans-serif; background: #fff0f5; text-align: center; padding: 20px; overflow: hidden; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 40px; border: 8px solid #ffb6c1; position: relative; min-height: 550px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        h1 { color: #ff69b4; margin-top: 0; font-size: 28px; }
        .progress { color: #ff8da1; font-size: 16px; margin-bottom: 10px; font-weight: bold; }
        
        /* Hi·ªáu ·ª©ng O / X */
        #feedback { font-size: 150px; font-weight: bold; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; pointer-events: none; display: none; text-shadow: 0 0 20px rgba(255,255,255,0.8); }
        .correct-mark { color: #ff4757; } 
        .wrong-mark { color: #54a0ff; }   

        .sound-box { font-size: 100px; margin: 20px 0; background: #fff9fa; border-radius: 30px; padding: 20px; cursor: pointer; border: 3px dashed #ffb6c1; transition: 0.3s; }
        .sound-box:hover { background: #ffe4e1; }
        
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        button.choice-btn { padding: 20px; font-size: 50px; border: 4px solid #ffcad4; border-radius: 25px; cursor: pointer; background: white; color: #ff69b4; font-weight: bold; box-shadow: 0 5px 0 #ffcad4; transition: 0.1s; }
        button.choice-btn:hover { background: #fff5f6; }
        button.choice-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-replay { background: #ff69b4; color: white; border: none; padding: 12px 30px; border-radius: 50px; font-size: 18px; margin-bottom: 20px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #d05090; }
        .btn-replay:active { transform: translateY(2px); box-shadow: none; }
        
        #finishScreen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; border-radius: 35px; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        #finishScreen h2 { font-size: 50px; color: #ff1493; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <!-- Hi·ªáu ·ª©ng O / X -->
    <div id="feedback"></div>

    <!-- M√†n h√¨nh k·∫øt th√∫c -->
    <div id="finishScreen">
        <h2>üéâ „ÇÑ„Å£„Åü„ÉºÔºÅ</h2>
        <p style="font-size: 22px; font-weight: bold; color: #ff69b4;">„Å≤„Çâ„Åå„Å™ „Åú„Çì„Å∂ „ÇØ„É™„Ç¢ÔºÅ<br>(B√© ƒë√£ thu·ªôc h·∫øt Hiragana!)</p>
        <button class="btn-replay" onclick="resetGame()">„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑ „ÅÇ„Åù„Å∂</button>
    </div>

    <h1>üé∂ „Å≤„Çâ„Åå„Å™ „ÇØ„Ç§„Ç∫</h1>
    <div class="progress">„ÅÆ„Åì„Çä (C√≤n l·∫°i): <span id="remainCount">104</span> / 104</div>
    
    <div class="sound-box" onclick="speakChar()">‚ùì</div>
    <button class="btn-replay" onclick="speakChar()">üîä „ÇÇ„ÅÜ„ÅÑ„Å°„Å© „Åç„Åè</button>
    
    <div id="options" class="options"></div>
</div>

<script>
    // Danh s√°ch 104 ch·ªØ Hiragana
    const fullAlphabet = [
        '„ÅÇ','„ÅÑ','„ÅÜ','„Åà','„Åä','„Åã','„Åç','„Åè','„Åë','„Åì','„Åï','„Åó','„Åô','„Åõ','„Åù','„Åü','„Å°','„Å§','„Å¶','„Å®','„Å™','„Å´','„Å¨','„Å≠','„ÅÆ','„ÅØ','„Å≤','„Åµ','„Å∏','„Åª','„Åæ','„Åø','„ÇÄ','„ÇÅ','„ÇÇ','„ÇÑ','„ÇÜ','„Çà','„Çâ','„Çä','„Çã','„Çå','„Çç','„Çè','„Çí','„Çì',
        '„Åå','„Åé','„Åê','„Åí','„Åî','„Åñ','„Åò','„Åö','„Åú','„Åû','„Å†','„Å¢','„Å•','„Åß','„Å©','„Å∞','„Å≥','„Å∂','„Åπ','„Åº','„Å±','„Å¥','„Å∑','„Å∫','„ÅΩ',
        '„Åç„ÇÉ','„Åç„ÇÖ','„Åç„Çá','„Åó„ÇÉ','„Åó„ÇÖ','„Åó„Çá','„Å°„ÇÉ','„Å°„ÇÖ','„Å°„Çá','„Å´„ÇÉ','„Å´„ÇÖ','„Å´„Çá','„Å≤„ÇÉ','„Å≤„ÇÖ','„Å≤„Çá','„Åø„ÇÉ','„Åø„ÇÖ','„Åø„Çá','„Çä„ÇÉ','„Çä„ÇÖ','„Çä„Çá','„Åé„ÇÉ','„Åé„ÇÖ','„Åé„Çá','„Åò„ÇÉ','„Åò„ÇÖ','„Åò„Çá','„Å≥„ÇÉ','„Å≥„ÇÖ','„Å≥„Çá','„Å¥„ÇÉ','„Å¥„ÇÖ','„Å¥„Çá'
    ];

    let playPool = [];
    let currentTarget = "";
    let isProcessing = false;

    function resetGame() {
        playPool = [...fullAlphabet];
        document.getElementById('finishScreen').style.display = 'none';
        nextQuestion();
    }

    function nextQuestion() {
        if (playPool.length === 0) {
            document.getElementById('finishScreen').style.display = 'flex';
            return;
        }

        isProcessing = false;
        document.getElementById('remainCount').innerText = playPool.length;
        
        // Ch·ªçn ng·∫´u nhi√™n t·ª´ kho c√≤n l·∫°i
        currentTarget = playPool[Math.floor(Math.random() * playPool.length)];
        
        // T·∫°o 4 l·ª±a ch·ªçn (1 ƒë√∫ng + 3 sai t·ª´ b·∫£ng g·ªëc)
        let choices = [currentTarget];
        while (choices.length < 4) {
            let randomChar = fullAlphabet[Math.floor(Math.random() * fullAlphabet.length)];
            if (!choices.includes(randomChar)) choices.push(randomChar);
        }
        choices.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';
        choices.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = char;
            btn.onclick = () => checkAnswer(char);
            optionsDiv.appendChild(btn);
        });
        
        setTimeout(speakChar, 400);
    }

    function checkAnswer(selected) {
        if (isProcessing) return;
        isProcessing = true;

        const feedback = document.getElementById('feedback');
        feedback.style.display = 'block';

        if (selected === currentTarget) {
            feedback.innerHTML = '<span class="correct-mark">‚óã</span>';
            playPool = playPool.filter(c => c !== currentTarget);
            
            setTimeout(() => {
                feedback.style.display = 'none';
                nextQuestion();
            }, 800);
        } else {
            feedback.innerHTML = '<span class="wrong-mark">√ó</span>';
            
            setTimeout(() => {
                feedback.style.display = 'none';
                isProcessing = false;
                speakChar(); 
            }, 800);
        }
    }

    function speakChar() {
        const synth = window.speechSynthesis;
        synth.cancel();
        const utter = new SpeechSynthesisUtterance(currentTarget);
        utter.lang = 'ja-JP';
        utter.rate = 0.7; // T·ªëc ƒë·ªô v·ª´a ph·∫£i cho b√©
        synth.speak(utter);
    }

    resetGame();
</script>

</body>
</html>